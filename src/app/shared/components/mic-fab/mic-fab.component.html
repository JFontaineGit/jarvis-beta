<div class="mic-fab-container">
  
  <!-- Manual Input Modal -->
  <div class="manual-input-overlay" 
       *ngIf="showManualInput" 
       (click)="showManualInput = false">
    <div class="manual-input-modal" (click)="$event.stopPropagation()">
      <h3>Escribe tu mensaje</h3>
      <textarea 
        [(ngModel)]="manualText"
        (keydown)="onKeyPress($event)"
        placeholder="Escribe aquÃ­ tu mensaje..."
        rows="3"
        maxlength="500"
        #textArea></textarea>
      <div class="modal-buttons">
        <button class="btn-cancel" (click)="onManualInputToggle()">
          Cancelar
        </button>
        <button class="btn-send" 
                (click)="onManualSubmit()" 
                [disabled]="!manualText.trim()">
          Enviar
        </button>
      </div>
    </div>
  </div>

  <!-- FAB Buttons Container -->
  <div class="fab-buttons">
    
    <!-- Manual Input Button -->
    <button class="fab-button secondary-fab"
            (click)="onManualInputToggle()"
            [disabled]="isProcessing"
            aria-label="Manual text input"
            title="Escribir mensaje">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
      </svg>
    </button>

    <!-- Main Microphone Button -->
    <button class="fab-button main-fab" 
            [class.listening]="isListening"
            [class.processing]="isProcessing"
            [disabled]="isProcessing"
            (click)="onToggleClick()"
            [attr.aria-label]="isListening ? 'Stop listening' : 'Start listening'"
            [title]="isListening ? 'Dejar de escuchar' : 'Empezar a escuchar'">
      
      <!-- Ripple effect -->
      <div class="ripple" *ngIf="isListening"></div>
      <div class="ripple delay-1" *ngIf="isListening"></div>
      <div class="ripple delay-2" *ngIf="isListening"></div>
      
      <!-- Processing spinner -->
      <div class="processing-spinner" *ngIf="isProcessing"></div>
      
      <!-- Microphone icon -->
      <svg *ngIf="!isProcessing" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="mic-icon">
        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
        <line x1="12" y1="19" x2="12" y2="23"/>
        <line x1="8" y1="23" x2="16" y2="23"/>
      </svg>
    </button>
  </div>
</div>